<?php

$jsonFile = __DIR__ . '/seo-meta-output.json';

$excludePostIds = [
    9067,
    12980,
    8280,
    8290,
    8270,
    8300,
    8310,
    8285,
    8275,
    8285,
    8295,
    8305,
    8315,
    8272,
    8282,
    8292,
    8302,
    8312,
    1218,
    969,
    981,
    942,
    957,
    1232,
    1100,
    1101,
    572,
    869,
    1753,
    1756,
    1762,
    1758,
    1760,
    1239,
    1139,
    1140,
    1136,
    1138,
    1219,
    970,
    982,
    944,
    958,
    1238,
    1226,
    976,
    1001,
    1003,
    988,
    1221,
    971,
    983,
    959,
    946,
    1222,
    972,
    984,
    947,
    960,
    1223,
    973,
    985,
    948,
    961,
    1224,
    974,
    986,
    949,
    962,
    1225,
    975,
    987,
    951,
    963,
    952,
    8277,
    8287,
    8297,
    8307,
    8317,
    964,
    1240,
    1143,
    1144,
    1141,
    1142,
    1237,
    1000,
    1002,
    650,
    826,
    10698,
    10703,
    10713,
    10720,
    10726,
    10696,
    10705,
    10715,
    10722,
    10728,
    10840,
    10843,
    10846,
    10849,
    10852,
    1227,
    977,
    989,
    953,
    965,
    1233,
    1121,
    1115,
    1106,
    1111,
    1231,
    996,
    997,
    994,
    995,
    8273,
    8293,
    8283,
    8303,
    8313,
    886,
    890,
    1241,
    1010,
    1015,
    72,
    824,
    10697,
    10704,
    10714,
    10721,
    10727,
    1246,
    1014,
    888,
    892,
    10694,
    10706,
    10716,
    10723,
    10729,
    827,
    1228,
    978,
    990,
    954,
    966,
    1019,
    12589,
    12587,
    12586,
    12585,
    12588,
    1229,
    979,
    991,
    955,
    967,
    8274,
    8284,
    8294,
    8304,
    8314,
    8322,
    8323,
    8324,
    8325,
    8326,
    10699,
    10702,
    10712,
    10719,
    10725,
    1214,
    922,
    923,
    928,
    123,
    825,
    1230,
    992,
    980,
    968,
    956,
    10661,
    10693,
    10707,
    10717,
    10724,
    10730,
    1244,
    1017,
    1012,
    10841,
    10844,
    10847,
    10850,
    10853,
    8279,
    8289,
    8299,
    8319,
    8309,
    1235,
    1118,
    1123,
    1109,
    1113,
    8278,
    8288,
    8298,
    8308,
    8318,
    8276,
    8286,
    8296,
    8306,
    8316,
    1234,
    1116,
    1112,
    1122,
    1108,
    8271,
    8281,
    8291,
    8301,
    8311,
    10839,
    10842,
    10848,
    10845,
    10848,
    10851,
    1236,
    1119,
    1105,
    1124,
    1110,
    1114,
    1016,
    1243,
    885,
    889,
    1245,
    1018,
    1011
];


if (!is_readable($jsonFile)) {
    fwrite(STDERR, "Error: Cannot read file: {$jsonFile}\n");
    exit(1);
}

$raw = file_get_contents($jsonFile);
$data = json_decode($raw, true);

if ($data === null && json_last_error() !== JSON_ERROR_NONE) {
    fwrite(STDERR, "Error: Invalid JSON - " . json_last_error_msg() . "\n");
    exit(1);
}

if (!is_array($data)) {
    fwrite(STDERR, "Error: JSON root is not an array\n");
    exit(1);
}

$excludeSet = array_flip($excludePostIds);
$before = count($data);
$data = array_values(array_filter($data, function ($item) use ($excludeSet) {
    $id = $item['post_id'] ?? null;
    return !isset($excludeSet[$id]);
}));
$removed = $before - count($data);

$json = json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
if ($json === false) {
    fwrite(STDERR, "Error: Failed to encode JSON\n");
    exit(1);
}

if (file_put_contents($jsonFile, $json) === false) {
    fwrite(STDERR, "Error: Cannot write file: {$jsonFile}\n");
    exit(1);
}

echo "Done. Removed {$removed} item(s), left " . count($data) . ".\n";
